<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bug Tracker</title>
    <style>
        .closed {
            color : red;
            text-decoration: line-through;
            font-style: italic;
            font-weight:  bold;
        }
    </style>
    <script src="handlebars-v4.0.5.js"></script>
    <script src="jquery-1.12.0.js"></script>
    <script src="underscore.js"></script>
    <script src="backbone.js"></script>

    <script type="text/x-template" id="bugsCollectionTemplate">

    </script>
    <script>
    var Bug = Backbone.Model.extend({
       defaults : {
            name : '',
            isClosed : false
       }
    });
    var BugsCollection = Backbone.Collection.extend({
        model : Bug,
        url : "http://localhost:3000/bugs"
    });
    var BugsCollectionView = Backbone.View.extend({
        templateId : "#bugsCollectionTemplate",
        initialize : function(){
            this.listenTo(this.collection, "add", this.displayBug.bind(this));
        },
        events : {
            "click #btnAdd" : "addNewBug"
        },
        addNewBug : function(){
            var newBugName = this.$("#txtBugName").val();
            this.collection.create({name : newBugName});
        },
        displayBug : function(bug){
                new BugView({
                    model : bug
                })
                .render()
                .$el
                .appendTo(this.$("#olBugList"));
        }
    });
    var BugView = Backbone.View.extend({
        tagName : 'li',
        initialize : function(){
            this.listenTo(this.model, 'change', this.render.bind(this));
        },
        render : function(){
            console.log(this.$el);
            this.$el.html(this.model.get('name'));
            if (this.model.get('isClosed')){
                this.$el.addClass("closed");
            } else {
                this.$el.removeClass('closed');
            }
            return this;
        }
    });

        var bugs = new BugsCollection();
        $(function(){
            var bugsView = new BugsCollectionView({
                collection : bugs,
                el : $("div.content")
            });
            bugs.fetch();
        })

    </script>
</head>
<body>
    <h1>Bug Tracker</h1>
    <hr>
    <div class="content">
        <label for="">Bug :</label>
        <input type="text" name="" id="txtBugName">
        <input type="button" value="Add New" id="btnAdd">
        <ol id="olBugList"></ol>
    </div>
</body>
</html>
